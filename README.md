# Управление светом велосипеда
![Welcome](https://github.com/nazbav/esp8266-bike-light-control/blob/master/photo_2024-09-04_19-06-12.jpg?raw=true "Welcome")

## Описание

Проект "Bike Light Control" представляет собой систему управления велосипедными огнями с использованием модуля ESP8266. Проект включает в себя как программное обеспечение для модуля ESP8266, так и веб-интерфейс для управления огнями через браузер.
Проект "Bike Light Control" предназначен для управления световыми сигналами на велосипеде с использованием ESP8266. Он включает в себя управление сигналами поворота, стоп-сигналами и режимами сигнальных огней через веб-интерфейс. Также поддерживает обновление прошивки по воздуху и сбор данных о состоянии устройства.


Инструкция как и почти весь код написаны - ChatGPT.

## Структура проекта

```
- web_api
  -- bike_light.html
  -- esp_ip.php
- bike_light.ino
- upload.bat
```

## Описание файлов

### `bike_light.ino`

Это основной файл для микроконтроллера ESP8266, написанный на языке программирования Arduino. Он содержит код для управления светодиодами, подключения к Wi-Fi и взаимодействия с веб-сервером.

### `upload.bat`

Скрипт для загрузки прошивки на модуль ESP8266 через HTTP. Использует `curl` для отправки запросов на обновление прошивки.

### `web_api/bike_light.html`

HTML-файл с интерфейсом для управления велосипедными огнями. Загружается на удаленный сервер API и предоставляет пользователю возможность управлять светодиодами через веб-браузер.

### `web_api/esp_ip.php`

PHP-скрипт, принимающий данные от модуля ESP8266 о состоянии и подключении. Эти данные сохраняются в JSON-файл на сервере для дальнейшего анализа.

## Настройка проекта

### Настройка микроконтроллера

1. **Подключение модулей:**
   Подключите модуль ESP8266 к компьютеру с помощью USB-адаптера. Убедитесь, что все соединения выполнены правильно, включая питание и соединение с компьютером.

2. **Конфигурация Wi-Fi:**
   Отредактируйте следующие строки в коде `bike_light.ino`:

   ```cpp
   const char *ssid = "YOUR_SSID";
   const char *password = "YOUR_PASSWORD";
   ```

   Замените `YOUR_SSID` и `YOUR_PASSWORD` на имя и пароль вашей сети Wi-Fi.

3. **Настройка сервера API:**
   Установите адрес сервера API, куда будет отправлять данные модуль ESP8266:

   ```cpp
   const char *server_api = "your.server.api";
   ```

   Замените `your.server.api` на адрес вашего сервера API.

4. **Загрузка прошивки:**
   Откройте Arduino IDE и загрузите файл `bike_light.ino` на модуль ESP8266. Убедитесь, что все необходимые библиотеки установлены.

### Настройка веб-интерфейса

1. **Развертывание на сервере:**
   Загрузите файлы `bike_light.html` и `esp_ip.php` на ваш веб-сервер. Эти файлы должны быть доступны через HTTP.

2. **Настройка `esp_ip.php`:**
   Убедитесь, что у вас есть файл `device_data.json` на сервере, куда будут записываться данные о состоянии устройства. Проверьте права доступа к этому файлу.

### Использование

1. **Запуск сервера:**
   После загрузки прошивки на модуль ESP8266, он подключится к Wi-Fi и начнет работать как веб-сервер.

2. **Открытие веб-интерфейса:**
   Откройте веб-браузер и перейдите по адресу, указанному в коде `bike_light.ino` или на IP-адрес вашего модуля ESP8266. Вы увидите интерфейс для управления светодиодами.

### Примеры использования

#### Управление сигналами поворота

На веб-странице вы можете включать и выключать сигналы поворота. Для этого есть кнопки "Left Turn" и "Right Turn", которые переключают соответствующие сигналы.

#### Управление стоп-сигналом

Вы можете включить стоп-сигнал, нажав кнопку "Stop". Стоп-сигнал будет активен в течение 5 секунд.

#### Обновление прошивки

Для обновления прошивки используйте кнопку "Update Firmware" на веб-интерфейсе. Это вызовет обновление прошивки через HTTP-запрос.

#### Перезагрузка устройства

Чтобы перезагрузить модуль, используйте кнопку "reboot" на веб-странице. Это перезапустит устройство и очистит текущие состояния.

## Скрипт обновления прошивки (`upload.bat`)

Этот скрипт предназначен для обновления прошивки на модуле ESP8266. Он принимает IP-адрес модуля и путь к файлу прошивки как параметры.

Пример использования:

```batch
upload.bat 192.168.1.100 C:\path\to\firmware.bin
```

Этот пример загрузит прошивку на устройство с IP-адресом `192.168.1.100`.

## Веб-интерфейс (`bike_light.html`)

HTML-файл предоставляет интерфейс для управления огнями. Он содержит следующие элементы:

- **Выбор устройства**: Выпадающий список для выбора устройства.
- **Кнопка "Light"**: Включает или выключает режим света.
- **Кнопки поворота**: Кнопки для управления сигналами поворота влево и вправо.
- **Кнопка "Stop"**: Включает стоп-сигнал.


## PHP скрипт для получения данных (`esp_ip.php`)

Скрипт `esp_ip.php` получает данные от устройства ESP8266 и сохраняет их в JSON-файл на сервере. Он принимает параметры через HTTP-запросы и обновляет данные о состоянии устройства.

Пример ответа JSON:

```json
{
  "status": "success",
  "message": "Data received successfully."
}
```

## Общая структура bike_light.ino

Код для файла `bike_light.ino` предназначен для управления велосипедными огнями с использованием микроконтроллера ESP8266. Он включает в себя подключение к Wi-Fi сети, запуск веб-сервера, управление светодиодами и обновление прошивки через веб-интерфейс.

## Основные компоненты

### 1. **Настройка подключения к Wi-Fi**

В начале программы происходит подключение к Wi-Fi сети. Указываются параметры сети, такие как SSID (имя сети) и пароль. Модуль ESP8266 пытается подключиться к указанной сети, и если подключение успешно, он переходит к следующему этапу.

### 2. **Запуск веб-сервера**

После успешного подключения к Wi-Fi, код инициализирует веб-сервер. Этот сервер слушает входящие HTTP-запросы на определенном порту (обычно порт 80). Веб-сервер обрабатывает запросы, поступающие от клиента (например, веб-браузера), и отвечает на них.

### 3. **Обработка HTTP-запросов**

Когда веб-сервер получает запросы, они обрабатываются функциями-обработчиками. В зависимости от типа запроса, сервер может выполнять различные действия, такие как включение или выключение светодиодов, обновление прошивки или перезагрузка устройства.

- **Команды управления светодиодами**: Если запрос связан с управлением светодиодами, сервер определяет, какой тип сигнала требуется (например, сигнал поворота, стоп-сигнал или обычное освещение) и включает соответствующие светодиоды.

- **Обновление прошивки**: При получении команды на обновление прошивки сервер начинает процесс загрузки новой прошивки на устройство. Это может включать скачивание файла прошивки и его установку.

- **Перезагрузка устройства**: При получении команды на перезагрузку сервер инициирует процесс перезагрузки микроконтроллера. Это может быть полезно для сброса состояния устройства или после обновления прошивки.

### 4. **Обновление прошивки**

Процесс обновления прошивки запускается через веб-интерфейс. Когда пользователь отправляет команду на обновление, устройство подключается к серверу обновлений и загружает новую прошивку. После завершения загрузки прошивка устанавливается, и устройство автоматически перезагружается для применения изменений.

### 5. **Запуск и управление светодиодами**

Программа управляет несколькими типами светодиодов для разных целей:

- **Сигналы поворота**: Включает и выключает светодиоды для индикации поворота влево или вправо.
- **Стоп-сигналы**: Включает светодиоды для подачи сигнала стопа, который активируется при необходимости.
- **Обычные огни**: Управляет обычным освещением велосипеда в зависимости от команды пользователя.

Каждый тип светодиодов управляется отдельно, и код контролирует их состояние в зависимости от команд, полученных через веб-интерфейс.

### 6. **Сбор данных и отправка на сервер**

Модуль ESP8266 может собирать данные о состоянии устройства и отправлять их на сервер. Это может включать информацию о текущем состоянии светодиодов, уровне сигнала или другие параметры, которые могут быть полезны для мониторинга или диагностики.

# Картинки

![Welcome](https://github.com/nazbav/esp8266-bike-light-control/blob/master/photo_2024-09-04_19-06-14.jpg?raw=true "Welcome")
![Welcome](https://github.com/nazbav/esp8266-bike-light-control/blob/master/photo_2024-09-04_19-06-21.jpg?raw=true "Welcome")
![Welcome](https://github.com/nazbav/esp8266-bike-light-control/blob/master/photo_2024-09-04_19-06-24.jpg?raw=true "Welcome")
